# 测试说明（按官方标签同步）

## 目标
- 验证与上游仓库保持一致：当上游标签（含 `latest`）发生变更时，ACR 中对应标签的 digest 跟随更新。
- 验证多架构复制与重名仓库前缀逻辑。

## 准备
- 在 GitHub Secrets 配好 `ALIYUN_*` 四个变量。
- 在 `images.txt` 中添加需要同步的上游仓库（不写 `:latest`）。
- 如只想同步部分标签，可将工作流中 `TAG_POLICY` 调整为 `latest_only` 或 `recent_N`。

## 步骤
1) 触发工作流：
   - 修改 `images.txt` 并提交；或在 Actions 手动触发；或等待定时任务。

2) 验证 digest 变化：
   ```bash
   # 查看多架构 manifest 信息
   skopeo inspect --raw docker://${ALIYUN_REGISTRY}/${ALIYUN_NAME_SPACE}/adguardhome:latest | sha256sum
   ```
   - 记录哈希值，等待上游更新 `latest` 后再次同步，对比哈希变化。

3) 验证自动更新（任选其一）：
   - Docker Compose：
     ```bash
     docker compose up -d --pull always
     ```
     若 digest 变化会自动拉取并重建。
   - Watchtower：
     确保能访问你的 ACR（私有仓库需凭据），查看日志应能检测到标签更新并执行重启。

## 预期
- 当上游标签（尤其 `latest`）发生变化时，ACR 中相应标签 digest 改变。
- 多架构保持与上游一致（使用 `--all`）。
- 如不同上游存在同名镜像，目标仓库会自动加命名空间前缀（小写，下划线连接）。
